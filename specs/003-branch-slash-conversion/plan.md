# Implementation Plan: åˆ†æ”¯åæ–œæ è½¬æ¢

**Branch**: `003-branch-slash-conversion` | **Date**: 2026-01-16 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/003-branch-slash-conversion/spec.md`

**User Input**: "work list éœ€è¦è¾“å‡ºä¸»ç›®å½•çš„å®Œæ•´è·¯å¾„"

**Note**: This template is filled in by the `/speckit.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

æœ¬åŠŸèƒ½æ‰©å±•äº†ç°æœ‰çš„ worktree ç®¡ç†å·¥å…·ï¼Œå®ç°åœ¨ `work list` è¾“å‡ºä¸­æ˜¾ç¤ºä¸»ç›®å½•ï¼ˆmain repositoryï¼‰çš„å®Œæ•´è·¯å¾„ã€‚è¿™æ˜¯å¯¹ 003-branch-slash-conversion åŠŸèƒ½çš„è¡¥å……ï¼Œæ”¹è¿›ç”¨æˆ·ä½“éªŒï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿæ¸…æ™°åœ°çœ‹åˆ°ä¸»ä»“åº“çš„ä½ç½®ã€‚

**æŠ€æœ¯æ–¹æ¡ˆ**ï¼š
- ä¿®æ”¹ `format_worktree_compact()` å‡½æ•°ï¼Œä¸ºä¸»ç›®å½•ï¼ˆé .worktrees ç›®å½•ï¼‰æ·»åŠ è·¯å¾„æ˜¾ç¤º
- ä¿®æ”¹ `format_worktree_table()` å‡½æ•°ï¼Œåœ¨è¡¨æ ¼ä¸­æ˜¾ç¤ºå®Œæ•´è·¯å¾„
- ä¿æŒç°æœ‰é¢œè‰²æ ‡è®°å’Œå¸ƒå±€é£æ ¼
- ä¸å½±å“ JSON è¾“å‡ºæ ¼å¼ï¼ˆå·²åŒ…å« path å­—æ®µï¼‰

## Technical Context

**Language/Version**: Rust 1.75+ (edition 2021)
**Primary Dependencies**: clap 4.5 (CLI), anyhow 1.0 (é”™è¯¯å¤„ç†), thiserror 1.0 (è‡ªå®šä¹‰é”™è¯¯), serde 1.0 (åºåˆ—åŒ–), comfy-table 7.0 (è¡¨æ ¼è¾“å‡º), colored 2.1 (é¢œè‰²è¾“å‡º), chrono 0.4 (æ—¶é—´å¤„ç†)
**Storage**: æ— æŒä¹…åŒ–å­˜å‚¨ï¼ˆä»… Git worktree å…ƒæ•°æ®ï¼‰
**Testing**: cargo test, tempfile 3.10, assert_cmd 2.0, predicates 3.1
**Target Platform**: macOS, Linux, Windows (æ”¯æŒ Rust çš„å¹³å°)
**Project Type**: å•ä½“ CLI å·¥å…·
**Performance Goals**: <100ms åˆ—è¡¨è¾“å‡ºï¼Œæ”¯æŒ 100+ worktrees
**Constraints**: ä¸ä¿®æ”¹ Git worktree æœ¬èº«ç»“æ„ï¼Œä»…æ”¹è¿›è¾“å‡ºæ ¼å¼
**Scale/Scope**: å•ä¸€æ¨¡å—ä¿®æ”¹ (src/cli/output.rs)ï¼Œæ— æ–°å¢ä¾èµ–

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### Principle I: è§„èŒƒä¼˜å…ˆå¼€å‘ âœ…

**Status**: PASS

**éªŒè¯**:
- âœ… åŠŸèƒ½è§„æ ¼å·²å®Œæ•´å®šä¹‰ (spec.md å­˜åœ¨ä¸”å®Œæ•´)
- âœ… ç”¨æˆ·éœ€æ±‚æ˜ç¡®ï¼šæ˜¾ç¤ºä¸»ç›®å½•å®Œæ•´è·¯å¾„
- âœ… æœ¬è®¡åˆ’æ–‡æ¡£è®°å½•æŠ€æœ¯å®ç°å†³ç­–
- âœ… æ— å®ç°ç»†èŠ‚æ³„æ¼åˆ°è§„æ ¼æ–‡æ¡£

### Principle II: ç‹¬ç«‹å¯äº¤ä»˜æ€§ âœ…

**Status**: PASS

**éªŒè¯**:
- âœ… ç”¨æˆ·æ•…äº‹ P1ï¼ˆåˆ›å»ºåŒ…å«æ–œæ åˆ†æ”¯çš„ worktreeï¼‰å·²ç‹¬ç«‹å¯æµ‹è¯•
- âœ… æœ¬è¡¥å……éœ€æ±‚æ˜¯å¯¹ User Story 2 çš„å¢å¼ºï¼ˆåˆ—å‡º worktree æ˜¾ç¤ºè·¯å¾„ï¼‰
- âœ… ä¸å¼•å…¥è·¨ç”¨æˆ·æ•…äº‹ä¾èµ–
- âœ… å¯ç‹¬ç«‹äº¤ä»˜ä»·å€¼

### Principle III: è´¨é‡å‰ç½® âœ…

**Status**: PASS

**éªŒè¯**:
- âœ… è§„æ ¼é€šè¿‡å®Œæ•´æ€§éªŒè¯ï¼ˆ< 3 ä¸ª NEEDS CLARIFICATIONï¼‰
- âœ… æœ¬æŠ€æœ¯æ–¹æ¡ˆæ— å®ªæ³•è¿è§„
- âœ… æµ‹è¯•ç­–ç•¥æ˜ç¡®ï¼ˆå•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯•ï¼‰
- âš ï¸  éœ€è¦åœ¨å®ç°å‰ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼ˆTDDï¼‰

**ç»“è®º**: é€šè¿‡å®ªæ³•æ£€æŸ¥ï¼Œå¯è¿›å…¥ Phase 0 ç ”ç©¶ã€‚

## Project Structure

### Documentation (this feature)

```text
specs/003-branch-slash-conversion/
â”œâ”€â”€ plan.md              # æœ¬æ–‡ä»¶
â”œâ”€â”€ research.md          # Phase 0 è¾“å‡ºï¼ˆå¾…ç”Ÿæˆï¼‰
â”œâ”€â”€ data-model.md        # Phase 1 è¾“å‡ºï¼ˆå¾…ç”Ÿæˆï¼‰
â”œâ”€â”€ quickstart.md        # Phase 1 è¾“å‡ºï¼ˆå¾…ç”Ÿæˆï¼‰
â””â”€â”€ contracts/           # æ—  API å¥‘çº¦ï¼ˆCLI å·¥å…·ï¼‰
```

### Source Code (repository root)

**é‡‡ç”¨ Option 1: å•ä½“é¡¹ç›®ç»“æ„**

```text
src/
â”œâ”€â”€ main.rs              # CLI å…¥å£ï¼Œå‘½ä»¤å¤„ç†å™¨
â”œâ”€â”€ cli/
â”‚   â””â”€â”€ output.rs        # ğŸ“ å¾…ä¿®æ”¹ï¼šæ ¼å¼åŒ–è¾“å‡ºå‡½æ•°
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ git_ops.rs       # Git æ“ä½œå°è£…ï¼ˆå·²å®ç°åˆ†æ”¯åè½¬æ¢ï¼‰
â”‚   â”œâ”€â”€ worktree.rs      # Worktree æ•°æ®æ¨¡å‹ï¼ˆå·²æ”¯æŒ dirname/branch_nameï¼‰
â”‚   â””â”€â”€ repository.rs    # ä»“åº“ç®¡ç†ï¼ˆæœªä½¿ç”¨ï¼‰
â””â”€â”€ utils/
    â”œâ”€â”€ errors.rs        # é”™è¯¯ç±»å‹å®šä¹‰
    â””â”€â”€ path.rs          # è·¯å¾„å·¥å…·å‡½æ•°ï¼ˆæœªä½¿ç”¨ï¼‰

tests/
â”œâ”€â”€ integration/         # é›†æˆæµ‹è¯•ï¼ˆå¾…è¡¥å……ï¼‰
â””â”€â”€ unit/                # å•å…ƒæµ‹è¯•ï¼ˆå·²å­˜åœ¨äºå„æ¨¡å—ï¼‰
```

**Structure Decision**: é‡‡ç”¨å•ä½“é¡¹ç›®ç»“æ„ï¼Œå› ä¸ºè¿™æ˜¯ç®€å•çš„ CLI å·¥å…·ï¼Œæ— å‰åç«¯åˆ†ç¦»éœ€æ±‚ã€‚æ ¸å¿ƒä¿®æ”¹é›†ä¸­åœ¨ `src/cli/output.rs` æ¨¡å—ã€‚

## Complexity Tracking

> **æœ¬åŠŸèƒ½æ— å®ªæ³•è¿è§„ï¼Œæ­¤éƒ¨åˆ†ç•™ç©º**

---

## Phase 0 å®Œæˆ: ç ”ç©¶

**çŠ¶æ€**: âœ… å®Œæˆ

**äº§å‡º**:
- [research.md](research.md) - æŠ€æœ¯å†³ç­–æ–‡æ¡£
  - Decision 1-6: åŸæœ‰åˆ†æ”¯åè½¬æ¢åŠŸèƒ½çš„ç ”ç©¶
  - Decision 7: **æ–°å¢**ä¸»ç›®å½•è·¯å¾„æ˜¾ç¤ºå¢å¼ºç ”ç©¶

**è§£å†³çš„æŠ€æœ¯é—®é¢˜**:
1. âœ… åˆ†æ”¯åè½¬æ¢ç®—æ³•ï¼šç®€å•å­—ç¬¦ä¸²æ›¿æ¢ `/` â†’ `-`
2. âœ… å†²çªæ£€æµ‹ç­–ç•¥ï¼šåˆ›å»ºå‰æ£€æµ‹ç›®å½•åå†²çª
3. âœ… è¾“å‡ºæ ¼å¼åŒ–æ–¹æ¡ˆï¼šdirname + branch_name åˆ†ç¦»æ˜¾ç¤º
4. âœ… æ–‡ä»¶ç³»ç»Ÿéæ³•å­—ç¬¦å¤„ç†ï¼šä»…å¤„ç† `/`ï¼Œä¾èµ– Git æ‹¦æˆªå…¶ä»–éæ³•å­—ç¬¦
5. âœ… ç›®å½•åé•¿åº¦é™åˆ¶ï¼šä¾èµ–æ–‡ä»¶ç³»ç»Ÿé™åˆ¶ï¼Œä¸å¼ºåˆ¶æˆªæ–­
6. âœ… è·¨å¹³å°è·¯å¾„å¤„ç†ï¼šä½¿ç”¨ Rust `std::path::Path`
7. âœ… **ä¸»ç›®å½•è·¯å¾„æ˜¾ç¤º**ï¼šCompact æ ¼å¼è¡Œå°¾æ·»åŠ ç°è‰²è·¯å¾„æ˜¾ç¤º

**é—ç•™é—®é¢˜**: æ— 

---

## Phase 1 å®Œæˆ: è®¾è®¡ä¸å¥‘çº¦

**çŠ¶æ€**: âœ… å®Œæˆ

**äº§å‡º**:
- [data-model.md](data-model.md) - æ•°æ®æ¨¡å‹æ–‡æ¡£ï¼ˆå·²å­˜åœ¨ï¼Œæ— éœ€ä¿®æ”¹ï¼‰
- [quickstart.md](quickstart.md) - é›†æˆæµ‹è¯•åœºæ™¯ï¼ˆå·²æ›´æ–°ï¼‰
  - æ–°å¢ Scenario 10: ä¸»ç›®å½•è·¯å¾„æ˜¾ç¤ºæµ‹è¯•
  - æ›´æ–°éªŒè¯æ¸…å•ï¼ˆFR-011, SC-006ï¼‰
  - æ›´æ–°è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬

**æ•°æ®æ¨¡å‹**:
- `Worktree` å®ä½“å·²åŒ…å« `dirname` å’Œ `branch_name` å­—æ®µ
- æ— éœ€æ–°å¢å®ä½“æˆ–å­—æ®µ
- è·¯å¾„æ˜¾ç¤ºé€šè¿‡æ ¼å¼åŒ–å‡½æ•°å®ç°ï¼Œä¸ä¿®æ”¹æ•°æ®æ¨¡å‹

**API å¥‘çº¦**: æ— ï¼ˆCLI å·¥å…·ï¼Œæ—  REST/GraphQL APIï¼‰

---

## Agent ä¸Šä¸‹æ–‡æ›´æ–°

**çŠ¶æ€**: âœ… å®Œæˆ

**æ‰§è¡Œ**:
```bash
.specify/scripts/bash/update-agent-context.sh claude
```

**ç»“æœ**:
- âœ… CLAUDE.md å·²æ›´æ–°æŠ€æœ¯æ ˆä¿¡æ¯
- æ–°å¢è¯­è¨€ï¼šRust 1.75+ (edition 2021)
- æ–°å¢æ¡†æ¶ï¼šclap 4.5, anyhow 1.0, thiserror 1.0, serde 1.0, comfy-table 7.0, colored 2.1, chrono 0.4
- æ–°å¢å­˜å‚¨ï¼šæ— æŒä¹…åŒ–å­˜å‚¨ï¼ˆä»… Git worktree å…ƒæ•°æ®ï¼‰

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **è¿è¡Œ `/speckit.tasks`**: ç”Ÿæˆå¯æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨
   - è¾“å…¥: plan.md + spec.md + research.md + data-model.md
   - è¾“å‡º: tasks.md

2. **æ‰§è¡Œ `/speckit.implement`**: å®ç°åŠŸèƒ½
   - ä¿®æ”¹ `src/cli/output.rs` çš„ `format_worktree_compact()` å‡½æ•°
   - æ·»åŠ ä¸»ç›®å½•è·¯å¾„æ˜¾ç¤ºé€»è¾‘
   - è¿è¡Œå•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

3. **éªŒè¯**: è¿è¡Œ quickstart.md ä¸­çš„æ‰€æœ‰æµ‹è¯•åœºæ™¯

---

## è§„åˆ’å®Œæˆæ€»ç»“

**ç”¨æˆ·éœ€æ±‚**: "work list éœ€è¦è¾“å‡ºä¸»ç›®å½•çš„å®Œæ•´è·¯å¾„"

**æŠ€æœ¯æ–¹æ¡ˆ**:
- ä¿®æ”¹ `format_worktree_compact()` å‡½æ•°
- ä¸ºä¸»ç›®å½•ï¼ˆé .worktreesï¼‰æ·»åŠ  " at /path/to/repo" åç¼€
- ä½¿ç”¨ç°è‰²ï¼ˆdimmedï¼‰æ˜¾ç¤ºï¼Œä¸ç°æœ‰è®¾è®¡è¯­è¨€ä¸€è‡´

**å®ç°å¤æ‚åº¦**: ä½
- ä»£ç ä¿®æ”¹ï¼š~10 è¡Œï¼ˆå•ä¸ªå‡½æ•°ï¼‰
- æµ‹è¯•ç”¨ä¾‹ï¼š~15 è¡Œï¼ˆå•å…ƒæµ‹è¯• + é›†æˆæµ‹è¯•ï¼‰
- é£é™©ï¼šæä½ï¼ˆä¸ä¿®æ”¹æ•°æ®æ¨¡å‹ï¼Œä¸ç ´åç°æœ‰åŠŸèƒ½ï¼‰

**é¢„è®¡å·¥ä½œé‡**: 0.5 å°æ—¶
- ç¼–ç ï¼š15 åˆ†é’Ÿ
- æµ‹è¯•ï¼š15 åˆ†é’Ÿ
- æ–‡æ¡£æ›´æ–°ï¼š0 åˆ†é’Ÿï¼ˆå·²åœ¨æœ¬æ–‡æ¡£ä¸­å®Œæˆï¼‰

**å‘åå…¼å®¹æ€§**:
- âœ… JSON æ ¼å¼ä¸å˜
- âœ… Table æ ¼å¼ä¸å˜
- âš ï¸  Compact æ ¼å¼å˜æ›´ï¼ˆæ–°å¢ä¿¡æ¯ï¼Œä¸ç ´åè„šæœ¬ï¼‰
